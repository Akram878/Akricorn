<div class="dashboard-paths">
  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± + Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯ -->
  <div class="header-row">
    <div class="header-row__title">
      <h2>Learning Paths</h2>
      <span class="header-row__subtitle"> Each path contains an ordered list of courses. </span>
    </div>

    <div class="header-row__actions">
      <button type="button" class="btn-primary btn-round" (click)="openCreateForm()">+</button>
      <button type="button" class="btn-secondary" (click)="loadPaths()">Reload</button>
    </div>
  </div>

  <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ù…Ø© -->
  <div class="status error" *ngIf="error">{{ error }}</div>
  <div class="status" *ngIf="isLoading">Loading...</div>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª -->
  <table *ngIf="!isLoading && paths.length > 0" class="paths-table">
    <thead>
      <tr>
        <th>ID</th>
        <th style="width: 18%">Title</th>
        <th>Description</th>
        <th>Price</th>
        <th>Discount (%)</th>
        <th>Rating</th>
        <th>Active</th>
        <th>Courses (ordered)</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let p of paths">
        <td>{{ p.id }}</td>
        <td>{{ p.title }}</td>
        <td class="description-cell">
          {{ p.description }}
        </td>
        <td>{{ p.price ?? 0 | currency : 'USD' : 'symbol' : '1.0-2' }}</td>
        <td>{{ p.discount ?? 0 | number : '1.0-2' }}%</td>
        <td>
          <div class="rating-chip">
            <span>{{ p.rating ?? 0 | number : '1.1-1' }}</span>
            <span class="rating-count">({{ p.ratingCount ?? 0 }})</span>
          </div>
        </td>

        <td>
          <span [class.badge-active]="p.isActive" [class.badge-inactive]="!p.isActive">
            {{ p.isActive ? 'Active' : 'Inactive' }}
          </span>
        </td>
        <td>
          <ol class="path-courses-list" *ngIf="p.courseIds?.length">
            <li *ngFor="let cid of p.courseIds">#{{ cid }} â€” {{ getCourseTitle(cid) }}</li>
          </ol>
          <span *ngIf="!p.courseIds || p.courseIds.length === 0">No courses</span>
        </td>
        <td class="actions-cell">
          <button class="btn-small" (click)="onEdit(p)">Edit</button>
          <button class="btn-secondary" (click)="onToggle(p)">
            {{ p.isActive ? 'Disable' : 'Enable' }}
          </button>
          <button class="btn-danger" (click)="onDelete(p)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="!isLoading && paths.length === 0" class="status">No learning paths found yet.</div>

  <!-- âœ… Ù…ÙˆØ¯Ø§Ù„ Ù…Ø³Ø§Ø± Ø§Ù„ØªØ¹Ù„Ù‘Ù… -->
  <div class="modal-backdrop" *ngIf="showForm" (click)="resetForm()">
    <div class="modal-card bg-secondary" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div>
          <h3 class="form-title">
            {{ editMode ? 'Edit Learning Path' : 'Create New Learning Path' }}
          </h3>
          <p class="form-subtitle">Path = name + description + ordered courses.</p>
        </div>

        <button type="button" class="icon-btn" (click)="resetForm()" aria-label="Close">Ã—</button>
      </div>

      <form [formGroup]="pathForm" (ngSubmit)="onSubmit()">
        <div class="form-grid">
          <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
          <div class="form-field">
            <label for="title">Title</label>
            <input
              id="title"
              type="text"
              formControlName="title"
              placeholder="e.g. Full Web Development Roadmap"
            />
          </div>

          <div class="form-field">
            <label for="thumbnailUrl">Thumbnail URL</label>
            <input
              id="thumbnailUrl"
              type="text"
              formControlName="thumbnailUrl"
              placeholder="https://..."
            />
          </div>

          <div class="form-field">
            <label for="price">Price</label>
            <input id="price" type="number" min="0" step="0.01" formControlName="price" />
          </div>

          <div class="form-field">
            <label for="discount">Discount (%)</label>
            <input
              id="discount"
              type="number"
              min="0"
              max="100"
              step="0.01"
              formControlName="discount"
            />
          </div>

          <!-- Ø§Ù„Ø­Ø§Ù„Ø© -->
          <div class="form-field checkbox-field">
            <label>
              <input type="checkbox" formControlName="isActive" />
              Active (visible in LMS)
            </label>
          </div>

          <!-- Ø§Ù„ÙˆØµÙ -->
          <div class="form-field full-width">
            <label for="description">Description</label>
            <textarea
              id="description"
              rows="3"
              formControlName="description"
              placeholder="Short description of the learning path..."
            ></textarea>
          </div>
        </div>

        <!-- ðŸ§  Ø¬Ø²Ø¡ ØªØ±ØªÙŠØ¨ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª -->
        <div class="path-courses-section">
          <label>Courses in this path (ordered)</label>

          <div class="path-courses-layout">
            <!-- Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© -->
            <div class="path-courses-available">
              <div class="available-header">
                <span>Available courses</span>
                <span *ngIf="isLoadingCourses" class="small-hint"> Loading... </span>
              </div>

              <select #courseSelector>
                <option [value]="''" disabled selected>Select course to add</option>
                <option *ngFor="let c of courses" [value]="c.id">
                  #{{ c.id }} â€” {{ c.title }}
                </option>
              </select>

              <button
                type="button"
                class="btn-small add-btn"
                (click)="onAddCourse(courseSelector.value)"
              >
                Add course
              </button>
            </div>

            <!-- Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³Ø§Ø± -->
            <div class="path-courses-selected">
              <div class="selected-header">
                <span>Path order</span>
                <span class="small-hint" *ngIf="!selectedCourseIds.length">
                  No courses selected yet.
                </span>
              </div>

              <ol class="selected-list" *ngIf="selectedCourseIds.length">
                <li *ngFor="let cid of selectedCourseIds; let i = index">
                  <div class="selected-item">
                    <span class="index-badge">{{ i + 1 }}</span>
                    <span class="course-label"> #{{ cid }} â€” {{ getCourseTitle(cid) }} </span>

                    <div class="item-actions">
                      <button
                        type="button"
                        class="btn-small"
                        (click)="moveCourseUp(i)"
                        [disabled]="i === 0"
                      >
                        â†‘
                      </button>
                      <button
                        type="button"
                        class="btn-small"
                        (click)="moveCourseDown(i)"
                        [disabled]="i === selectedCourseIds.length - 1"
                      >
                        â†“
                      </button>
                      <button type="button" class="btn-danger btn-small" (click)="removeCourse(i)">
                        âœ•
                      </button>
                    </div>
                  </div>
                </li>
              </ol>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-primary" [disabled]="pathForm.invalid || isSaving">
            {{
              isSaving
                ? editMode
                  ? 'Saving...'
                  : 'Creating...'
                : editMode
                ? 'Save Changes'
                : 'Create Path'
            }}
          </button>

          <button type="button" class="btn-secondary" (click)="resetForm()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>
