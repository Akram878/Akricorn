<div class="dashboard-books">
  <ng-container *ngIf="!isEditorOpen">
    <div class="header-row">
      <div class="header-row__title">
        <h2>Books</h2>
        <span class="header-row__subtitle">Manage Akricorn library books.</span>
      </div>

      <div class="header-row__actions">
        <button type="button" class="btn-primary btn-round" (click)="openCreateEditor()">+</button>
        <button type="button" class="btn-secondary" (click)="loadBooks()">Reload</button>
      </div>
    </div>

    <div class="status error" *ngIf="error">{{ error }}</div>
    <div class="status" *ngIf="isLoading">Loading...</div>

    <table *ngIf="!isLoading && books.length > 0" class="books-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Category</th>
          <th>Price</th>
          <th>Rating</th>
          <th>Active</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let b of books">
          <td>{{ b.id }}</td>
          <td>{{ b.title }}</td>
          <td>{{ b.category }}</td>
          <td>{{ b.price | currency : 'USD' : 'symbol' : '1.0-2' }}</td>
          <td>
            <div class="rating-chip">
              <span>{{ b.rating ?? 0 | number : '1.1-1' }}</span>
              <span class="rating-count">({{ b.ratingCount ?? 0 }})</span>
            </div>
          </td>
          <td>
            <span [class.badge-active]="b.isActive" [class.badge-inactive]="!b.isActive">
              {{ b.isActive ? 'Active' : 'Inactive' }}
            </span>
          </td>
          <td class="actions-cell">
            <button class="btn-secondary" (click)="onToggle(b)">
              {{ b.isActive ? 'Disable' : 'Enable' }}
            </button>
            <button class="btn-danger" (click)="onDelete(b)">Delete</button>
            <button class="btn-small btn-primary" (click)="openEditEditor(b)">Edit</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!isLoading && books.length === 0" class="status">No books found yet.</div>
  </ng-container>

  <div *ngIf="isEditorOpen" class="editor-wrapper">
    <app-book-editor
      [form]="bookForm"
      [bookId]="selectedBook?.id ?? 0"
      [isCreateMode]="isCreateMode"
      [isSaving]="isSaving"
      [isLoadingDetails]="isLoadingDetails"
      [files]="bookFiles"
      (thumbnailSelected)="handleThumbnailSelected($event)"
      (filesUpdated)="handleFilesUpdated($event)"
      (closeEditor)="closeEditor()"
      (submitForm)="onSubmitEditor()"
    ></app-book-editor>
  </div>
</div>
