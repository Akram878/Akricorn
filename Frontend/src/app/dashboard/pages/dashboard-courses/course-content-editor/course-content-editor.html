<div class="course-content-editor">
  <div class="editor-topbar">
    <button type="button" class="btn-icon" (click)="closeEditor.emit()">‚Üê Back</button>

    <div class="editor-topbar__title">
      <h2>{{ isCreateMode ? 'Create New Course' : 'Edit Course' }}</h2>
      <p class="subtitle">
        {{
          isCreateMode
            ? 'Configure a new course, its metadata, and content.'
            : 'Manage course information, sections, lessons & files.'
        }}
      </p>
    </div>
  </div>

  <div class="editor-body">
    <!-- LEFT SIDE -->
    <div class="editor-left">
      <div class="card overview-card">
        <h3>Course Overview</h3>

        <div class="thumbnail-block">
          <div class="thumbnail-preview">
            <img
              *ngIf="form.get('thumbnailUrl')?.value; else noThumb"
              [src]="form.get('thumbnailUrl')?.value"
              alt="Course thumbnail"
            />
            <ng-template #noThumb>
              <div class="thumbnail-placeholder">No thumbnail</div>
            </ng-template>
          </div>

          <div class="thumbnail-actions">
            <label class="btn-secondary">
              Upload Image
              <input type="file" accept="image/*" hidden (change)="onThumbnailSelected($event)" />
            </label>
          </div>
        </div>

        <div class="overview-meta">
          <div class="overview-item">
            <span class="label">Course ID</span>
            <span class="value">{{ isCreateMode ? 'New' : courseId }}</span>
          </div>

          <div class="overview-item">
            <span class="label">Category</span>
            <span class="value">{{ form.get('category')?.value || '-' }}</span>
          </div>

          <div class="overview-item">
            <span class="label">Hours</span>
            <span class="value">{{ form.get('hours')?.value || 0 }} h</span>
          </div>

          <div class="overview-item">
            <span class="label">Price</span>
            <span class="value">
              {{ form.get('price')?.value || 0 | currency : 'USD' : 'symbol' : '1.0-2' }}
            </span>
          </div>

          <div class="overview-item">
            <span class="label">Active</span>
            <span class="value">{{ form.get('isActive')?.value ? 'Yes' : 'No' }}</span>
          </div>
        </div>
      </div>

      <!-- FORM (Reactively controlled by DashboardCourses) -->
      <div class="card form-card">
        <h3>Course Details</h3>

        <form (ngSubmit)="submitForm.emit()">
          <div class="form-grid">
            <div class="form-field">
              <label>Title</label>
              <input type="text" [formControl]="form.get('title')" />
            </div>

            <div class="form-field">
              <label>Category</label>
              <input type="text" [formControl]="form.get('category')" />
            </div>

            <div class="form-field">
              <label>Hours</label>
              <input type="number" min="0" [formControl]="form.get('hours')" />
            </div>

            <div class="form-field">
              <label>Price</label>
              <input type="number" step="0.01" min="0" [formControl]="form.get('price')" />
            </div>
          </div>

          <div class="form-field">
            <label>Description</label>
            <textarea rows="4" [formControl]="form.get('description')"></textarea>
          </div>

          <div class="form-grid">
            <div class="form-field">
              <label>Learning Path</label>
              <select [formControl]="form.get('learningPathId')">
                <option [ngValue]="null">No learning path</option>
                <option *ngFor="let p of paths" [ngValue]="p.id">{{ p.title }}</option>
              </select>
            </div>
          </div>

          <div class="form-field checkbox-field">
            <label>
              <input type="checkbox" [formControl]="form.get('isActive')" />
              Active
            </label>
          </div>

          <div class="form-actions">
            <button class="btn-primary" type="submit">
              {{ isCreateMode ? 'Create Course' : 'Save Changes' }}
            </button>

            <button type="button" class="btn-secondary" (click)="closeEditor.emit()">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- RIGHT SIDE CONTENT -->
    <div class="editor-right">
      <div class="card">
        <h3>Course Content</h3>

        <p *ngIf="isCreateMode" class="hint">Save the course first to add Sections & Lessons.</p>

        <div *ngIf="!isCreateMode">
          <div class="loading" *ngIf="loading">Loading...</div>
          <div class="error" *ngIf="error">{{ error }}</div>

          <!-- ADD SECTION -->
          <div class="add-section">
            <h4>Add Section</h4>
            <input type="text" [(ngModel)]="newSectionTitle" placeholder="Section title" />
            <input type="number" [(ngModel)]="newSectionOrder" min="1" placeholder="Order" />
            <button (click)="addSection()">Add Section</button>
          </div>

          <hr />

          <!-- SECTIONS -->
          <div class="section-block" *ngFor="let s of content?.sections">
            <div class="section-header">
              <input [(ngModel)]="s.title" />
              <input type="number" [(ngModel)]="s.order" min="1" />
              <button (click)="saveSection(s)">Save</button>
              <button (click)="deleteSection(s.id)">Delete</button>
            </div>

            <!-- ADD LESSON -->
            <div class="add-lesson">
              <h4>Add Lesson</h4>
              <input type="text" [(ngModel)]="newLessonTitle[s.id]" placeholder="Lesson title" />
              <input type="number" [(ngModel)]="newLessonOrder[s.id]" min="1" placeholder="Order" />
              <button (click)="addLesson(s)">Add Lesson</button>
            </div>

            <!-- LESSONS -->
            <div class="lesson-block" *ngFor="let l of s.lessons">
              <div class="lesson-header">
                <input [(ngModel)]="l.title" />
                <input type="number" [(ngModel)]="l.order" min="1" />
                <button class="btn-secondary" (click)="saveLesson(l)">Save</button>
                <button class="btn-danger" (click)="deleteLesson(l.id)">Delete Lesson</button>
              </div>

              <!-- FILE UPLOAD -->
              <div class="file-upload">
                <p>Upload Files for this lesson</p>
                <input type="file" multiple (change)="onFilesSelected($event, l.id)" />
              </div>

              <!-- FILE LIST -->
              <div class="files-list">
                <div class="file-row" *ngFor="let f of l.files">
                  <span>{{ f.fileName }}</span>
                  <button class="btn-danger" (click)="deleteFile(f.id)">Delete</button>
                </div>
              </div>
            </div>

            <hr />
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
