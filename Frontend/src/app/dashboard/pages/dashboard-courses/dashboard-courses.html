<div class="dashboard-courses">
  <!-- ===========================
       LIST VIEW
       =========================== -->
  <ng-container *ngIf="!isEditorOpen">
    <div class="header-row">
      <div class="header-row__title">
        <h2>Courses</h2>
        <span class="header-row__subtitle"> Manage Akricorn LMS courses. </span>
      </div>

      <div class="header-row__actions">
        <button type="button" class="btn-primary btn-round" (click)="openCreateEditor()">+</button>
        <button type="button" class="btn-secondary" (click)="loadCourses()">Reload</button>
      </div>
    </div>

    <div class="status error" *ngIf="error">{{ error }}</div>
    <div class="status" *ngIf="isLoading">Loading...</div>

    <table *ngIf="!isLoading && courses.length > 0" class="courses-table">
      <thead>
        <tr>
          <th>ID</th>
          <th style="width: 18%">Name</th>
          <th>Price</th>
          <th>Discount</th>
          <th>Rating</th>
          <th>Purchases</th>
          <th>Hours</th>
          <th>Path IDs</th>
          <th>Active</th>

          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let c of courses">
          <td>{{ c.id }}</td>
          <td>{{ c.title }}</td>

          <td>{{ c.price | currency : 'USD' : 'symbol' : '1.0-2' }}</td>
          <td>{{ c.discount ?? 0 | currency : 'USD' : 'symbol' : '1.0-2' }}</td>
          <td>{{ c.rating | number : '1.1-1' }}</td>
          <td>{{ c.purchaseCount ?? 0 }}</td>
          <td>{{ c.hours }}</td>
          <td>{{ c.pathIds.length ? c.pathIds.join(', ') : '-' }}</td>

          <td>
            <span [class.badge-active]="c.isActive" [class.badge-inactive]="!c.isActive">
              {{ c.isActive ? 'Active' : 'Inactive' }}
            </span>
          </td>

          <td class="actions-cell">
            <button class="btn-secondary" (click)="onToggle(c)">
              {{ c.isActive ? 'Disable' : 'Enable' }}
            </button>

            <button class="btn-danger" (click)="onDelete(c)">Delete</button>

            <button class="btn-small btn-primary" (click)="openEditEditor(c)">Edit</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!isLoading && courses.length === 0" class="status">No courses found yet.</div>
  </ng-container>

  <!-- ===========================
       CALL THE EDITOR COMPONENT
       =========================== -->
  <div *ngIf="isEditorOpen" class="editor-wrapper">
    <app-course-content-editor
      [courseId]="selectedCourse?.id ?? 0"
      [courseTitle]="courseForm.get('title')?.value"
      [isCreateMode]="isCreateMode"
      [form]="courseForm"
      [paths]="paths"
      (thumbnailSelected)="handleThumbnailSelected($event)"
      (closeEditor)="closeEditor()"
      (submitForm)="onSubmitEditor()"
      (reloadCourses)="loadCourses()"
      (thumbnailSelected)="handleThumbnailSelected($event)"
    ></app-course-content-editor>
  </div>
</div>
