<div class="lms-section">
  <div class="lms-section__header">
    <div class="lms-section__breadcrumb">
      <span>LMS</span>
      <span>/</span>
      <span class="active">Learning Paths</span>
    </div>

    <h2>Learning Paths</h2>
    <p>Structured roadmaps that connect multiple courses into a coherent progression.</p>
  </div>

  <div class="lms-section__body">
    <app-lms-filters
      [filters]="filters"
      [state]="filterState"
      [resultCount]="filteredPaths.length"
      (stateChange)="applyFilters($event)"
      (reset)="resetFilters()"
    ></app-lms-filters>

    <div class="lms-section__content">
      <div class="lms-path-grid" *ngIf="!isLoading && !error && filteredPaths.length > 0">
        <article class="lms-path-card" *ngFor="let p of filteredPaths; trackBy: trackByPathId">
          <header class="lms-path-card__header">
            <h3>{{ p.title }}</h3>
            <button type="button" class="lms-path-card__toggle" (click)="togglePath(p)">
              {{ p.isExpanded ? 'Hide courses' : 'View courses' }}
            </button>
          </header>

          <p class="lms-path-card__subtitle">{{ p.description }}</p>

          <div class="lms-path-card__meta">
            <span>{{ p.coursesCount }} courses</span>
            <span>{{ p.completedCourses }} completed</span>
          </div>

          <div class="lms-path-card__progress">
            <div class="lms-path-card__progress-bar">
              <div class="lms-path-card__progress-fill" [style.width.%]="p.completionPercent"></div>
            </div>
            <span>{{ p.completionPercent | number : '1.0-0' }}%</span>
          </div>

          <div class="lms-path-card__courses" *ngIf="p.isExpanded">
            <div
              class="lms-path-card__course"
              *ngFor="let course of p.courses; trackBy: trackByCourseId"
              [class.is-completed]="course.isCompleted"
            >
              <span class="order">{{ course.order }}</span>
              <span class="title">{{ course.title }}</span>
              <span class="status" *ngIf="course.isCompleted">Completed</span>
            </div>
          </div>

          <footer class="lms-path-card__footer">
            <div class="lms-path-card__price" *ngIf="!p.isOwned">
              <span class="lms-path-card__price-label">Price</span>
              <div class="lms-path-card__price-values">
                <span
                  class="lms-path-card__price-value"
                  [class.lms-path-card__price-value--strikethrough]="hasDiscount(p)"
                >
                  {{ getBasePrice(p) | number : '1.2-2' }} $
                </span>
                <span
                  class="lms-path-card__price-value lms-path-card__price-value--final"
                  *ngIf="hasDiscount(p)"
                >
                  {{ getFinalPrice(p) | number : '1.2-2' }} $
                </span>
              </div>
              <span class="lms-path-card__price-discount" *ngIf="hasDiscount(p)">
                Save {{ getDiscountPercent(p) | number : '1.0-0' }}%
              </span>
            </div>

            <button
              type="button"
              class="lms-primary-btn"
              [class.is-disabled]="p.isOwned"
              [disabled]="p.isPurchasing || p.isOwned"
              (click)="onPurchase(p)"
            >
              {{ p.isOwned ? 'Owned' : p.isPurchasing ? 'Processing...' : 'Buy Path' }}
            </button>
          </footer>
        </article>
      </div>

      <div class="lms-section__state" *ngIf="isLoading">Loading learning paths...</div>

      <div
        class="lms-section__state lms-section__state--empty"
        *ngIf="!isLoading && !error && filteredPaths.length === 0"
      >
        No learning paths match the selected filters.
      </div>

      <div class="lms-section__state lms-section__state--error" *ngIf="!isLoading && error">
        {{ error }}
      </div>
    </div>
  </div>
</div>
