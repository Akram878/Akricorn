<div class="lms-library-page">
  <div class="lms-library-page__header">
    <div class="lms-library-page__breadcrumb">
      <span>LMS</span>
      <span>/</span>
      <span class="active">Library</span>
    </div>

    <h2>Digital Library</h2>
    <p>
      Explore a selection of digital books. This page now displays real books from the backend
      instead of demo items.
    </p>
  </div>

  <!-- Top bar: search + filter -->
  <div class="lms-library-page__topbar">
    <div class="lms-library-page__search">
      <input
        type="text"
        placeholder="Search by title or description"
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
      />
    </div>

    <div class="lms-library-page__filter">
      <label>Category:</label>
      <select [(ngModel)]="selectedCategory" (change)="onCategoryChange()">
        <option value="all">All</option>
        <option *ngFor="let category of categories" [value]="category">
          {{ category }}
        </option>
      </select>
    </div>
  </div>

  <!-- Empty / error states -->
  <div class="lms-library-page__state" *ngIf="!isLoading && error">
    {{ error }}
  </div>

  <div class="lms-library-page__state" *ngIf="!isLoading && !error && filteredBooks.length === 0">
    Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØªØ¨ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«/Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.
  </div>

  <!-- Books List -->
  <div class="lms-library-list" *ngIf="!isLoading && !error && filteredBooks.length > 0">
    <article
      class="lms-book-row hovershadow"
      *ngFor="let b of filteredBooks; trackBy: trackByBookId"
      [class.lms-book-row--owned]="isBookOwned(b)"
    >
      <!-- Cover -->
      <div class="lms-book-row__cover">
        <div class="lms-book-row__cover-art">
          <img *ngIf="bookThumbnails[b.id]" [src]="bookThumbnails[b.id]" alt="{{ b.title }}" />
          <span *ngIf="!bookThumbnails[b.id]">ğŸ“˜</span>
        </div>
      </div>

      <!-- MAIN CONTENT -->
      <div class="lms-book-row__content">
        <header class="lms-book-row__header">
          <div>
            <h3 class="lms-book-row__title">{{ b.title }}</h3>

            <!-- Ø¨Ø¯Ù„ author Ù…Ù† Ø§Ù„Ø¯ÙŠÙ…Ùˆ Ù†Ø¶Ø¹ description -->
            <p class="lms-book-row__author">
              {{ b.description }}
            </p>
          </div>

          <!-- level (ÙƒÙ„Ù…Ø© Ø«Ø§Ø¨ØªØ© Ø­ØªÙ‰ Ù„Ø§ ÙŠØªØ£Ø«Ø± Ø§Ù„Ø¯ÙŠØ²Ø§ÙŠÙ†) -->
          <span class="lms-book-row__level">Digital Book</span>
        </header>

        <!-- Meta (Ø§Ù„Ø¯ÙŠØ²Ø§ÙŠÙ† Ø§Ù„Ø£ØµÙ„ÙŠ Ù…Ø­ÙÙˆØ¸) -->
        <div class="lms-book-row__meta">
          <span *ngIf="b.category">{{ b.category }}</span>
          <span class="lms-book-row__tag">E-Book</span>
          <span class="lms-book-row__owned" *ngIf="isBookOwned(b)">Owned</span>
        </div>
      </div>

      <!-- FOOTER -->
      <footer class="lms-book-row__footer">
        <div class="lms-book-row__price">
          <span class="label">Price</span>
          <span class="value">{{ b.price | number : '1.2-2' }} $</span>
        </div>

        <!-- If a file exists -->

        <button
          type="button"
          class="lms-secondary-btn"
          (click)="onAction(b)"
          [disabled]="processingBookId === b.id"
        >
          {{
            isBookOwned(b)
              ? 'View in My Books'
              : processingBookId === b.id
              ? 'Processing...'
              : 'Purchase'
          }}
        </button>
      </footer>
    </article>
  </div>
</div>
