<div class="lms-section">
  <div class="lms-section__header">
    <div class="lms-section__breadcrumb">
      <span>LMS</span>
      <span>/</span>
      <span class="active">My books</span>
    </div>

    <h2>My books</h2>
    <p>All books you own, either purchased directly or unlocked from your courses.</p>
  </div>

  <div class="lms-section__body">
    <app-lms-filters
      [filters]="filters"
      [state]="filterState"
      [resultCount]="filteredBooks.length"
      (stateChange)="applyFilters($event)"
      (reset)="resetFilters()"
    ></app-lms-filters>

    <div class="lms-section__content">
      <ng-container *ngIf="!isLoading; else loadingTpl">
        <div
          class="lms-section__state lms-section__state--empty"
          *ngIf="!error && myBooks.length === 0"
        >
          Your library is empty.
        </div>
        <div
          class="lms-section__state lms-section__state--empty"
          *ngIf="!error && myBooks.length > 0 && filteredBooks.length === 0"
        >
          No books match the selected filters yet.
        </div>
        <div class="lms-section__state lms-section__state--error" *ngIf="!isLoading && error">
          {{ error }}
        </div>

        <div class="lms-library-grid" *ngIf="!error && filteredBooks.length > 0">
          <app-book-card
            *ngFor="let b of filteredBooks; trackBy: trackByBookId"
            [book]="b"
            [owned]="true"
            [showBuy]="false"
            [showRate]="hasViewedBook(b)"
            [rateDisabled]="!canRateBook(b)"
            (view)="openFile(b)"
            (rate)="openRatingModal(b)"
          ></app-book-card>
        </div>
      </ng-container>

      <ng-template #loadingTpl>
        <div class="lms-section__state">Loading your books...</div>
      </ng-template>
    </div>
  </div>
</div>

<section class="book-rating" *ngIf="isRatingModalOpen">
  <div class="book-rating__backdrop" (click)="closeRatingModal()"></div>
  <div class="book-rating__panel" role="dialog" aria-modal="true">
    <header class="book-rating__header">
      <h3>Rate book</h3>
      <p>{{ selectedBook?.title }}</p>
    </header>
    <div class="book-rating__stars">
      <button
        type="button"
        class="book-rating__star"
        *ngFor="let star of ratingStars"
        (click)="selectRating(star)"
        [class.is-selected]="star <= ratingValue"
      >
        â˜…
      </button>
    </div>
    <button
      type="button"
      class="book-rating__submit"
      (click)="submitRating()"
      [disabled]="isSubmittingRating || ratingValue < 1"
    >
      {{ isSubmittingRating ? 'Sending...' : 'Submit rating' }}
    </button>
    <div class="book-rating__actions">
      <button
        type="button"
        class="lms-secondary-btn"
        (click)="closeRatingModal()"
        [disabled]="isSubmittingRating"
      >
        Cancel
      </button>
    </div>
  </div>
</section>
