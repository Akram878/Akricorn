<article
  class="lms-course-card card"
  [class.lms-course-card--owned]="owned"
  (click)="toggleReveal()"
>
  <div class="card-inner" [class.is-revealed]="isRevealed">
    <div class="card-front">
      <div class="head_card">
        <h3 class="lms-course-card__title">{{ course.title }}</h3>
        <div class="lms-course-card__thumb">
          <ng-container *ngIf="getThumbnailUrl() as thumbnailUrl; else thumbFallback">
            <img [src]="thumbnailUrl" [alt]="course.title ?? 'Course thumbnail'" loading="lazy" />
          </ng-container>
          <ng-template #thumbFallback>
            <div class="lms-course-card__thumb-placeholder" aria-hidden="true">
              <svg class="logo__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 134 155">
                <defs>
                  <!-- تدرج أزرق أعمق (محفور) -->
                  <linearGradient id="blueDeepGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" stop-color="hsl(214deg 62% 48%)" />
                    <stop offset="50%" stop-color="hsl(215deg 60% 42%)" />
                    <stop offset="100%" stop-color="hsl(216deg 58% 36%)" />
                  </linearGradient>

                  <!-- ظل داخلي ناعم جدًا (عمق فقط) -->
                  <filter id="softInset" x="-20%" y="-20%" width="140%" height="140%">
                    <feOffset dx="0" dy="1" />
                    <feGaussianBlur stdDeviation="1.5" />
                    <feComposite operator="out" in2="SourceAlpha" />
                    <feColorMatrix
                      type="matrix"
                      values="
          0 0 0 0 0
          0 0 0 0 0
          0 0 0 0 0
          0 0 0 0.35 0"
                    />
                    <feMerge>
                      <feMergeNode />
                      <feMergeNode in="SourceGraphic" />
                    </feMerge>
                  </filter>
                </defs>

                <g fill="url(#blueDeepGradient)" filter="url(#softInset)">
                  <path
                    d="M70.3,114.4c-0.8,23,15.4,37,17.4,38.6c-2.6,0.1-18.5,0.8-30.9-11.6
      c-9.8-9.8-11.3-21.7-11.6-25.1c-0.1-1.8-0.7-19.2,13.5-30.9
      c13.3-10.9,28.8-8.1,30.9-7.7C87.4,79.3,71.1,91.9,70.3,114.4z"
                  />
                  <path
                    d="M132.4,52.5c-15.6-22.6-39.8-34.3-61.9-30c-3.9,0.8-21.4,5-31.9,20.6
      c-1.7,2.6-6.6,10.1-7.5,20.6c-0.6,7.1,0.8,12.9,1.9,16.9
      c2.7,10.2,5.9,12.3,7.5,18.8c1.3,5.5,1.4,14-5.6,26.3
      c-3.5-2.1-27.2-17-31.9-46.9c-3.7-24,6.4-47.7,24.4-61.9
      C51-1.9,85.2-1.9,108,15C125.2,27.6,130.7,45.7,132.4,52.5z"
                  />
                </g>
              </svg>
            </div>
          </ng-template>
        </div>
      </div>
      <div class="lms-course-card__meta">
        <div class="lms-course-card__meta-item">
          <span class="lms-course-card__meta-label">Rating</span>

          <span class="lms-course-card__meta-value"> {{ getRating() | number : '1.1-1' }} / 5</span>
        </div>

        <div class="lms-course-card__meta-item" *ngIf="course.category">
          <span class="lms-course-card__meta-label">Category</span>

          <span class="lms-course-card__meta-value">{{ course.category }}</span>
        </div>

        <div class="lms-course-card__meta-item" *ngIf="course.pathTitle">
          <span class="lms-course-card__meta-label">Path</span>

          <span class="lms-course-card__meta-value">{{ course.pathTitle }}</span>
        </div>

        <div
          class="lms-course-card__meta-item"
          *ngIf="course.hours !== null && course.hours !== undefined"
        >
          <span class="lms-course-card__meta-label">Duration</span>

          <span class="lms-course-card__meta-value">{{ course.hours }} hours</span>
        </div>
      </div>

      <footer class="lms-course-card__footer">
        <div class="lms-course-card__price" *ngIf="!owned">
          <span class="lms-course-card__price-label">Price</span>

          <div class="lms-course-card__price-values">
            <span
              class="lms-course-card__price-value"
              [class.lms-course-card__price-value--strikethrough]="hasDiscount()"
            >
              {{ getBasePrice() | number : '1.2-2' }} $
            </span>

            <span
              class="lms-course-card__price-value lms-course-card__price-value--final"
              *ngIf="hasDiscount()"
            >
              {{ getFinalPrice() | number : '1.2-2' }} $
            </span>
          </div>

          <span class="lms-course-card__price-discount" *ngIf="hasDiscount()">
            Save {{ getDiscountPercent() | number : '1.0-0' }}%
          </span>
        </div>

        <button
          type="button"
          class="lms-primary-btn"
          (click)="onPurchase(); $event.stopPropagation()"
          [disabled]="isProcessing"
        >
          {{ owned ? 'View' : isProcessing ? 'Processing...' : 'Buy' }}
        </button>
      </footer>
    </div>

    <div class="card-back" *ngIf="getDescription() as description">
      <p class="lms-course-card__description">{{ description }}</p>
    </div>
  </div>
</article>
