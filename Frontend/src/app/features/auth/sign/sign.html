<div class="sign-wrapper">
  <!-- Signup box -->
  <form class="sign" [formGroup]="signForm" (ngSubmit)="signup()" novalidate>
    <!-- Name + Family -->
    <div class="field-row">
      <!-- NAME -->
      <div
        class="field"
        [class.field-invalid]="nameCtrl?.invalid && (nameCtrl?.touched || submitted)"
      >
        <input type="text" placeholder="Name" formControlName="name" maxlength="30" />

        <!-- Error icon -->
        <div class="field-icon" *ngIf="nameCtrl?.invalid && (nameCtrl?.touched || submitted)">
          !
          <div class="field-tooltip">
            <span *ngIf="nameCtrl?.errors?.['required']"> Name is required. </span>
            <span *ngIf="nameCtrl?.errors?.['minlength']"> Name must be at least 3 letters. </span>
            <span *ngIf="nameCtrl?.errors?.['latinOnly']"> Name must use A–Z letters only. </span>
          </div>
        </div>
      </div>

      <!-- FAMILY -->
      <div
        class="field"
        [class.field-invalid]="familyCtrl?.invalid && (familyCtrl?.touched || submitted)"
      >
        <input type="text" placeholder="Family" maxlength="30" formControlName="family" />

        <div class="field-icon" *ngIf="familyCtrl?.invalid && (familyCtrl?.touched || submitted)">
          !
          <div class="field-tooltip">
            <span *ngIf="familyCtrl?.errors?.['required']"> Family name is required. </span>
            <span *ngIf="familyCtrl?.errors?.['minlength']">
              Family name must be at least 3 letters.
            </span>
            <span *ngIf="familyCtrl?.errors?.['latinOnly']">
              Family name must use A–Z letters only. Family name must contain letters only.
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Phone -->
    <div class="field-row phone-row">
      <!-- COUNTRY CODE -->
      <div
        class="field compact key country-field"
        [class.field-invalid]="countryCodeCtrl?.invalid && (countryCodeCtrl?.touched || submitted)"
      >
        <app-country-select
          formControlName="countryCode"
          [required]="true"
          [invalid]="!!countryCodeCtrl?.invalid && (countryCodeCtrl?.touched || submitted)"
        />
      </div>
      <!-- NUMBER -->
      <div
        class="field number number-field"
        [class.field-invalid]="numberCtrl?.invalid && (numberCtrl?.touched || submitted)"
      >
        <input
          type="text"
          placeholder="Number"
          formControlName="number"
          (blur)="numberCtrl?.markAsTouched()"
        />

        <div class="field-icon" *ngIf="numberCtrl?.invalid && (numberCtrl?.touched || submitted)">
          !
          <div class="field-tooltip">
            <span *ngIf="numberCtrl?.errors?.['required']"> Phone number is required. </span>
            <span *ngIf="numberCtrl?.errors?.['pattern']">
              Only digits allowed (7–15 characters).
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Email -->
    <div
      class="field"
      [class.field-invalid]="emailCtrl?.invalid && (emailCtrl?.touched || submitted)"
    >
      <input type="email" placeholder="Email" formControlName="email" />

      <div class="field-icon" *ngIf="emailCtrl?.invalid && (emailCtrl?.touched || submitted)">
        !
        <div class="field-tooltip">
          <span *ngIf="emailCtrl?.errors?.['required']"> Email is required. </span>
          <span *ngIf="emailCtrl?.errors?.['pattern']"> Please enter a valid email address. </span>
        </div>
      </div>
    </div>

    <!-- City + Date of birth (single row) -->
    <div class="field-row">
      <!-- City -->
      <div
        class="field"
        [class.field-invalid]="cityCtrl?.invalid && (cityCtrl?.touched || submitted)"
      >
        <input type="text" placeholder="City" maxlength="50" formControlName="city" />

        <div class="field-icon" *ngIf="cityCtrl?.invalid && (cityCtrl?.touched || submitted)">
          !
          <div class="field-tooltip">
            <span *ngIf="cityCtrl?.errors?.['required']"> City is required. </span>
            <span *ngIf="cityCtrl?.errors?.['minlength']"> City name is too short. </span>
          </div>
        </div>
      </div>

      <!-- Date of birth -->
      <div
        class="field"
        [class.field-invalid]="birthDateCtrl?.invalid && (birthDateCtrl?.touched || submitted)"
      >
        <input type="date" placeholder="Date of birth" formControlName="birthDate" />

        <div
          class="field-icon"
          *ngIf="birthDateCtrl?.invalid && (birthDateCtrl?.touched || submitted)"
        >
          !
          <div class="field-tooltip">
            <span *ngIf="birthDateCtrl?.errors?.['required']"> Date of birth is required. </span>
            <span *ngIf="birthDateCtrl?.errors?.['ageOutOfRange']">
              Age must be between 12 and 100.
            </span>
            <span *ngIf="birthDateCtrl?.errors?.['invalidDate']"> Invalid date. </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Password -->
    <div
      class="field"
      [class.field-invalid]="passwordCtrl?.invalid && (passwordCtrl?.touched || submitted)"
    >
      <input type="password" placeholder="Password" formControlName="password" maxlength="50" />

      <div class="field-icon" *ngIf="passwordCtrl?.invalid && (passwordCtrl?.touched || submitted)">
        !
        <div class="field-tooltip">
          <span *ngIf="passwordCtrl?.errors?.['required']"> Password is required. </span>
          <span *ngIf="passwordCtrl?.errors?.['pattern']">
            Password must be at least 6 characters and include 1 uppercase letter, 1 number, and 1
            symbol (A–Z only).
          </span>
        </div>
      </div>
    </div>

    <!-- Confirm Password -->
    <div
      class="field"
      [class.field-invalid]="
       (confirmPasswordCtrl?.touched || submitted) &&
        (confirmPasswordCtrl?.invalid || signForm?.errors?.['passwordMismatch'])
      "
    >
      <input type="password" placeholder="Confirm password" formControlName="confirmPassword" />

      <div
        class="field-icon"
        *ngIf="
         (confirmPasswordCtrl?.touched || submitted) &&
          (confirmPasswordCtrl?.invalid || signForm?.errors?.['passwordMismatch'])
        "
      >
        !
        <div class="field-tooltip">
          <span *ngIf="confirmPasswordCtrl?.errors?.['required']">
            Please confirm your password.
          </span>
          <span *ngIf="signForm?.errors?.['passwordMismatch']"> Passwords do not match. </span>
        </div>
      </div>
    </div>

    <!-- Buttons -->
    <div class="buttonContainer">
      <button type="submit" class="btn signup-btn" [disabled]="loading">
        {{ loading ? 'Signing up...' : 'Sign Up' }}
      </button>

      <div>
        <div class="policy-field" [class.field-invalid]="submitted && policyCtrl?.invalid">
          <div class="policy-container">
            <input
              class="checkbox"
              type="checkbox"
              id="privacyPolicy"
              formControlName="acceptedPolicy"
              [class.checkbox-invalid]="submitted && policyCtrl?.invalid"
            />
            <label for="privacyPolicy">
              I agree to the
              <button type="button" class="policy-link" (click)="openPrivacyPolicy($event)">
                Privacy Policy
              </button>
            </label>
          </div>
        </div>
        <button type="button" class="login-link txtna" (click)="switchToLogin($event)">
          I have an account
        </button>
      </div>
    </div>
  </form>

  <div class="privacy-overlay" *ngIf="showPrivacyPolicy">
    <div class="privacy-backdrop" (click)="closePrivacyPolicy()"></div>
    <div class="privacy-modal" role="dialog" aria-modal="true">
      <div class="privacy-header">
        <button type="button" class="privacy-close" (click)="closePrivacyPolicy()">Close</button>
        <h2>Privacy Policy</h2>
      </div>
      <div class="privacy-content">
        <p>
          We value your privacy. Your information is used only to provide account access,
          personalize your experience, and secure your data. We do not sell your personal data.
        </p>
        <p>
          By creating an account, you consent to the processing of your information for service
          operation, customer support, and legal compliance. You can request access or deletion of
          your data by contacting support.
        </p>
        <p>
          We use industry-standard security practices to protect your data. For more details,
          contact our support team.
        </p>
      </div>
    </div>
  </div>
</div>
